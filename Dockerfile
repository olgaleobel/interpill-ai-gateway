# --- build stage ---
FROM gradle:8.7-jdk21 AS build
WORKDIR /home/gradle/src
COPY . .
# ?????????? wrapper ? ?????????? ????? ??? CI
RUN ./gradlew --no-daemon clean shadowJar -x test

# --- run stage ---
FROM eclipse-temurin:21-jre
WORKDIR /app
# ????? ????? *-all.jar, ?? ???????????? ? ?????/??????
COPY --from=build /home/gradle/src/build/libs/*-all.jar /app/app.jar

# Render ??????????? ???? ? 
ENV PORT=8080
EXPOSE 8080
CMD ["java","-jar","/app/app.jar"]